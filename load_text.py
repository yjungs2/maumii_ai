import asyncio
import httpx
import time

URL = "http://localhost:8000/analyze/batch"
BATCH_SIZE = 10
TEXTS = [ 
    "오늘은 정말 즐거운 하루야",
    "너무 화가 나서 참기 힘들어",
    "갑자기 큰 소리에 깜짝 놀랐어",
    "왠지 모르게 불안하고 무서워",
    "마음을 가라앉히고 차분해지고 싶어",
    "정말 행복한 기분이야",
    "보기만 해도 역겨워",
    "조용히 앉아 있으니 마음이 편안하다",
    "친구를 만나서 즐거웠어",
    "시험을 망쳐서 속상하다",
    "기대하지 않았는데 선물을 받아서 놀랐어",
    "밤길을 걷는데 두려웠어",
    "명상을 하니 마음이 차분해진다",
    "오늘 하루가 너무 신나",
    "냄새가 역겹다",
    "차분히 글을 읽고 있어",
    "웃을 일이 많아서 기뻐",
    "계속 짜증나는 일이 생겨",
    "예상치 못한 사건에 깜짝 놀랐어",
    "낯선 사람을 만나서 긴장됐다",
    "소풍을 가서 신나고 설레.",
    "원하는 대학에 합격해서 기쁘다.",
    "가족과 함께 식사하니 행복하다.",
    "좋아하는 노래를 들어서 기분이 좋다.",
    "친구가 칭찬해 줘서 기분이 날아갈 듯해.",
    "오래 기다리던 소식을 들어서 웃음이 난다.",
    "바람이 시원해서 상쾌하다.",
    "오늘은 모든 일이 잘 풀려서 즐겁다.",
    "오랜만에 여행을 가니 두근거린다.",
    "좋은 성적을 받아서 뿌듯하다.",
    "약속을 취소해서 너무 아쉽다.",
    "비 오는 날이라 괜히 우울하다.",
    "보고 싶은 친구를 만나지 못해 슬프다.",
    "기대했던 일이 실패로 끝나서 속상하다.",
    "외로워서 눈물이 난다.",
    "반려동물을 잃어서 마음이 아프다.",
    "가족과 다퉈서 마음이 무겁다.",
    "혼자 남겨진 느낌이 들어 슬프다.",
    "좋은 추억이 떠올라 그리움이 밀려온다.",
    "헤어진 기억이 아직 아프다.",
    "약속 시간을 지키지 않아 화가 난다.",
    "불공평한 대우에 분노한다.",
    "계속 떠드는 소리에 짜증이 난다.",
    "불친절한 태도에 속이 끓는다.",
    "억울한 상황이라 견디기 힘들다.",
    "무시당해서 화가 치민다.",
    "교통 체증 때문에 화가 난다.",
    "말을 안 들어서 짜증이 솟구친다.",
    "억지 주장에 화를 참기 어렵다.",
    "불합리한 규칙 때문에 속이 터진다.",
    "갑자기 불이 꺼져서 깜짝 놀랐다.",
    "예상치 못한 선물을 받아 당황스러웠다.",
    "친구가 몰래 나타나서 깜짝 놀랐다.",
    "처음 보는 광경에 놀라움을 감추지 못했다.",
    "큰 소리가 나서 깜짝 놀랐다.",
    "믿을 수 없는 소식에 어안이 벙벙하다.",
    "갑작스러운 질문에 얼떨떨했다.",
    "전혀 예상하지 못한 결과에 놀랐다.",
    "새로운 기술이 신기해서 놀랐다.",
    "뜻밖의 제안에 당황했다.",
    "낯선 골목길이 무서웠다.",
    "중요한 시험이 다가와서 긴장된다.",
    "어두운 방에 혼자 있으니 두렵다.",
    "미래가 불확실해 걱정된다.",
    "면접을 앞두고 긴장된다.",
    "이상한 소리가 들려서 무서웠다.",
    "혼자 집에 있으니 불안하다.",
    "실수를 할까 봐 초조하다.",
    "낯선 사람의 시선이 무섭다.",
    "중요한 발표 때문에 가슴이 뛴다.",
    "음악을 들으니 마음이 편안하다.",
    "따뜻한 차를 마시며 차분해진다.",
    "해변을 바라보니 마음이 고요하다.",
    "책을 읽으며 여유를 느낀다.",
    "깊은 호흡을 하니 마음이 가라앉는다.",
    "공원을 산책하며 평온해진다.",
    "창밖을 보며 차분히 생각한다.",
    "일기를 쓰면서 마음이 정리된다.",
    "파도 소리를 들으니 마음이 안정된다.",
    "조용한 방에서 휴식을 취하니 좋다.",
    "상한 음식을 보고 역겨웠다.",
    "불쾌한 냄새가 나서 싫었다.",
    "지저분한 방이 보기 싫다.",
    "무례한 태도가 혐오스럽다.",
    "더러운 물건이 손에 닿아 기분이 나쁘다.",
    "땀 냄새 때문에 불쾌하다.",
    "불공정한 행동이 보기 역겹다.",
    "음식을 함부로 먹는 모습이 싫다.",
    "쓰레기가 쌓여 있는 모습을 보니 불쾌하다.",
    "위생이 나빠서 먹기 꺼려진다.",
    "하늘이 맑아 기분이 상쾌하다.",
    "계획이 무산돼서 허무하다.",
    "좋은 소식을 들어서 미소가 번진다.",
    "친구가 배신해서 분노가 치민다.",
    "큰 성취를 이루어 자랑스럽다.",
    "소중한 물건을 잃어 속상하다.",
    "오랜 꿈을 이뤄서 기쁘다.",
    "뜻하지 않은 실패로 낙담했다.",
    "불쾌한 장면을 보고 눈살이 찌푸려졌다.",
    "사랑하는 사람을 만나서 행복하다."
]*10 # 100개 데이터

async def send_batch(client, texts, idx):
    start = time.time()
    resp = await client.post(URL, json={"texts": texts})
    elapsed = time.time() - start
    try:
        data = resp.json()
    except Exception:
        data = {"error": resp.status_code, "body": resp.text}
    return elapsed, data

async def main():
    total_start = time.time()
    async with httpx.AsyncClient(timeout=30.0) as client:
        tasks = []
        for i in range(0, len(TEXTS), BATCH_SIZE):
            batch = TEXTS[i:i+BATCH_SIZE]
            tasks.append(send_batch(client, batch, i//BATCH_SIZE + 1))
        results = await asyncio.gather(*tasks)
    total_elapsed = time.time() - total_start

    for i, (elapsed, data) in enumerate(results, 1):
        print(f"Batch {i}: {elapsed:.2f}s → {len(data.get('results', []))}개 처리")

    print(f"\n전체 1000개 요청 완료 시간: {total_elapsed:.2f}s")

asyncio.run(main())